<%- include('fragments/head.ejs') %>
<body>
<%- include('fragments/nav.ejs') %>

<main>
  <h1>Profil utilisateur</h1>

  <% if (user) { %>
    <% if (error) { %>
      <p class="muted"><%= error %></p>
    <% } %>
    <% if (message) { %>
      <p><%= message %></p>
    <% } %>

    <div class="profil-card">
      <div class="profil-avatar">
        <% if (user.profil_picture) { %>
          <img src="<%= user.profil_picture %>" alt="Photo de profil">
        <% } else { %>
          <div class="avatar-placeholder">ðŸ‘¤</div>
        <% } %>
      </div>

      <div class="profil-info">
        <dl class="profil-details">
          <dt>Identifiant</dt>
          <dd><%= user.login %></dd>
          <dt>RÃ´le</dt>
          <dd><%= user.profil %></dd>
          <dt>ID MongoDB</dt>
          <dd><%= user._id %></dd>
        </dl>
      </div>
    </div>

    <div class="profil-actions">
      <% if (user.login !== 'adminweb' && user.login !== 'sysadmin') { %>
        <form class="form-panel" action="/profil/update" method="post">
          <div>
            <label for="login">Modifier identifiant</label>
            <input id="login" name="login" type="text" value="<%= user.login %>" required>
          </div>
          <div>
            <label for="password">Nouveau mot de passe (optionnel)</label>
            <input id="password" name="password" type="password" minlength="8">
          </div>
          <div>
            <label for="confirmPassword">Confirmer nouveau mot de passe</label>
            <input id="confirmPassword" name="confirmPassword" type="password" minlength="8">
          </div>
          <button type="submit">Enregistrer</button>
        </form>
        <form
          class="form-panel form-panel-compact"
          action="/profil/delete"
          method="post"
          data-confirm-message="Supprimer definitivement votre compte ?"
        >
          <button class="delete-account-btn" type="submit">Supprimer mon compte</button>
        </form>
      <% } else { %>
        <p>Compte systeme: modification du profil desactivee.</p>
      <% } %>
    </div>
  <% } else { %>
    <p class="muted">Aucune donnÃ©e utilisateur disponible.</p>
  <% } %>
</main>

<%- include('fragments/footer.ejs') %>
</body>
</html>
